extends ../layout

block scripts
    script(src="/javascripts/jade-runtime.js", type="text/javascript")
    script(src="/javascripts/kanban.home.index.js", type="text/javascript")
    != assets.tag('/partials.js')

    script(type='text/javascript')

        var io = io.connect();

        $(function(){
            $('#doit').click(function(){
                io.emit('createUserStory', {});
            });
        });

        io.on('userStoryCreated', function(userStory){
            $('#new').append(Partials['userStory'](userStory));
        });

        io.on('userStoryStageUpdated', function(userStory){
            $('#' + userStory._id).fadeOut(500, function(){
                $('#' + userStory._id).appendTo('#' + userStory.stage);
                $('#' + userStory._id).fadeIn(500);
            });
        });

        $(document).bind('coolestBananas.kanban.home.index.userStoryChangedStage', function(e, data){
            io.emit('updateUserStoryStage', data);
        });


block content
    #kanban-board
        #new.stage
            .stage-title
                h3 New
            .stage-stories
                !=renderStageStories('new', userStories);
        #in-progress.stage
            .stage-title
                h3 In Progress
            .stage-stories
                !=renderStageStories('in-progress', userStories);
        #complete.stage
            .stage-title
                h3 Complete
            .stage-stories
                !=renderStageStories('complete', userStories);